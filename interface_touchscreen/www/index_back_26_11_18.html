<!DOCTYPE html>
<html>
<head>

	<title>DOMO</title> 	
	<meta charset="utf-8">	
<!--<meta name="viewport" content="width=device-width, initial-scale=1"> -->
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

<script src="js/jquery-1.9.1.js"></script>

<script src="./js/jquery-ui-1.11.4.min.js"></script>
<script src="./js/jquery.ui.touch-punch.min.js"></script>

<script src="./js/jquery.mobile-1.4.5.min.js"></script>

<link rel="stylesheet" href="./css/jquery.mobile-1.4.5.min.css" />

  <!-- clock -->
  <script type="text/javascript" src="clock/clock.js"></script>
   <link rel="stylesheet" href="clock/clock.css">
  
  <!-- clock picker
<link rel="stylesheet" type="text/css" href="./datetimepicker/DateTimePicker.css" />

<script type="text/javascript" src="./datetimepicker/DateTimePicker.js"></script>
-->
  <!-- datebox -->
 <script type="text/javascript" src="./datebox/datebox.js"></script>
 <link rel="stylesheet" href="./datebox/datebox.css" />
  <!-- clockpicker -->
 <script type="text/javascript" src="./clockpicker/clockpicker.js"></script>
 <link rel="stylesheet" href="./clockpicker/clockpicker.css" />
  
<!-- spinbox temperature-->
<script type="text/javascript" src="./spinbox/jqm-spinbox.js"></script>
  
<!-- rosbridge -->
  <script type="text/javascript" src="js/WebSocketTest.js"></script>
	<script src="js/eventemitter2.js"></script>
	<script src="js/roslib.js"></script>


<style type="text/css">

body{

	 margin:0;
	 padding:0;
  font-family: -webkit-pictograph;

}
.ui-mobile .ui-page {
  min-height: 200px;
}
.ui-content{
font-family: -webkit-pictograph;
height: 245px;
padding: 2px 2px;
}
.ui-header .ui-title, .ui-footer .ui-title{
padding: 2px 2px;
}
.ui-header  .ui-content {
padding: 4px 4px;
}
.ui-listview > .ui-li-static {
    padding: 0px 0px;

}
.ui-content .ui-listview-inset{
	margin: 0px 0px
}

.img-status, .img-schedule{
height: 30px;
}

.img-mini{
height: 25px;
}

 .button-blind {
    
  padding: 5px;
  padding-top: 5px;
   margin: 2px;
    
  }
.img-button{
	border-radius: 4px;
	background: #333333;
    margin: 0px 20px;
	padding: 5px;
}

.img-but{
height: 45px;
  padding-top: 5px;
}
  
#list_events{
  padding: 0px 0px;
}

#list_new{
  padding: 5px 0px;
}

  .list-schedule{
    padding-top: 0px;
    padding-bottom: 0px;
    margin-right: 0px;
  }

  
  #header{
  
    height: 60px;
  }
.header-but {
  
  width: 110px;
  height: 30px;
  margin-top: 5px;
  padding-top: 6px;
  
  
  }
  .ui-header .ui-btn{
    font-size:x-large;
  }

  .header-title{
    
    margin-top:12px;
    text-align: center;
    
  } 
  #page_home ul li {
    
    font-size: 32px;
  }
 

</style>

</head>




<body onload="start_ros();" >

<!--
<body>
-->
<!-- Home -->

<div data-role="page" id="page_home" data-theme="b">

 <div data-role="header" >   

    <div id="header" class="ui-grid-b"  >
        <div class="ui-block-a" style="width: 35%" >
          <a id="rad_button" href="#page_radiator"  class="ui-btn ui-corner-all ui-shadow ui-btn-b header-but "  >Radiador</a>
        </div>
        <div class="ui-block-b" style="width: 30%" >
            <div id="title_page" style="margin-top:8px">
              <div class="clock">
                <div id="Date"></div>

                <ul>
                    <li id="hours"> </li>
                    <li id="point">:</li>
                    <li id="min"> </li>
                    <li id="point">:</li>
                    <li id="sec"> </li>
                </ul>

              </div>
            </div>
        </div>
				
        <div class="ui-block-c" style="width: 30%">
						
            
                <a id="blind_button" href="#page_blind"  class="ui-btn ui-corner-all ui-shadow ui-btn-b header-but" style="margin-left:2px;"  >Persiana</a>

            

      </div>
					
    </div><!-- /grid-b -->
  </div>
	
  <div data-role="content" data-theme="b" style="height: 200px;">

    <div class="ui-grid-b"  >
        <div class="ui-block-a" style="width:36%">
            <ul id="list_status_rad" data-role="listview" data-inset="true">
              <li >
                <div class="ui-grid-a" style="height:70px" >
                  <div class="ui-block-a" >
                    <img src="./images/termometro.png" alt="temp" style="margin-top: 10px;margin-left: 10px;" /> 
                  </div>
                  <div class="ui-block-b" >
                    <div id="t_setpoint" class="icon-" style="font-size: 40px;">--.-</div>
                  </div>
                </div>
              </li>
              <li>
                <div id="grid_adj_temp_rad" class="ui-grid-a" style="padding-left: 10px;padding-top:2px;display:none;color:red;font-size: 30px;" >
                  <div class="ui-block-a" >
                    Aj. temp. > 
                  </div>
                  <div class="ui-block-b" >
                    <div id="adj_temp_time_rad" class="icon-">--.-</div>
                  </div>
                </div>
                
              </li>
              <li>
                <div class="ui-grid-a" style="padding-left: 10px;padding-top: 2px;" >
                  <div class="ui-block-a" >
                    <div id="next_1_time_rad" class="icon-">--.-</div> 
                  </div> 
                  <div class="ui-block-b" >
                    <div id="next_1_temp_rad" class="icon-">--.-</div>
                  </div>
                </div>
                
              </li>
              <li>
                <div class="ui-grid-a" style="padding-left: 10px;padding-top: 2px;">
                  <div class="ui-block-a" >
                    <div id="next_2_time_rad" class="icon-">--:--</div> 
                  </div> 
                  <div class="ui-block-b" >
                    <div id="next_2_temp_rad" class="icon-">--.-</div>
                  </div>
                </div>
                
              </li>
            </ul>
        </div>
          <div class="ui-block-b"  style="width:30%">
            <ul data-role="listview" data-inset="true">
              <li>
                <div id="t_int" style="font-size:70px;text-align: center;">--.-</div>
              </li>
              <li >
                <div class="ui-grid-a" style="height:40px;padding-left:10px;" >
                  <div class="ui-block-a" >
                      <img src="./images/puerta.png" alt="temp" /> 
                  </div>
                  <div class="ui-block-b" >
                    <div id="door_st" class="icon-" style="font-size:18px;margin-top: 10px;"></div>
                  </div>
              </div>
              </li>
              <li >
                <div class="ui-grid-a" style="height:40px;padding-left:10px;" >
                  <div class="ui-block-a" >
                      <img src="./images/ventana.png" alt="temp" /> 
                  </div>
                  <div class="ui-block-b" >
                    <div id="window_st" class="icon-" style="font-size:18px;margin-top: 10px;"></div>
                  </div>
              </div>
              </li>
            </ul>
        </div>
       <div class="ui-block-c" >
            <ul id="list_status_blind" data-role="listview" data-inset="true">
              <li >
                 <div class="ui-grid-a" style="height:50px;padding-left: 10px;padding-top: 2px;" >
                  <div class="ui-block-a" >
                    <img id="status_blind_position" src="./images/persiana_0.png" class="img-but" style="padding-left: 20px;"/>
                  </div>
                  <div class="ui-block-b" >
                    
                      <img id="status_blind_push" src="" class="img-mini" />
                    
                  </div>
                </div>
                  
              </li>
              <li>
                <div class="ui-grid-a" style="padding-left: 10px;padding-top: 2px;" >
                  <div class="ui-block-a" >
                    <div id="next_1_time_blind" >--:--</div> 
                  </div>
                  <div class="ui-block-b" >
                    
                      <img id="next_1_pose_blind" src="" class="img-mini" />
                    
                  </div>
                </div>
              </li>
              <li>
                <div class="ui-grid-a" style="padding-left: 10px;padding-top: 2px;" >
                  <div class="ui-block-a" >
                    <div id="next_2_time_blind" >--:--</div> 
                  </div>
                  <div class="ui-block-b" >
                    
                      <img id="next_2_pose_blind" src="" class="img-mini" />
                    
                  </div>
                </div>
              </li>
            </ul>
        </div>
    </div>
    </div><!-- /content -->
  
    <div data-role="footer" style="height:40px;padding: 6px;"> 
    <div class="ui-grid-e" style="height:100%;">
        <div class="ui-block-a" >
          <img id="comm_st" src="./images/central_comm.png" class="img-mini" alt="valve" />
          
        </div>
          <div class="ui-block-b" >
            <img id="mode_st" src="./images/mode_auto.png" class="img-mini" alt="boiler" />
          </div>
        <div class="ui-block-c" >
        
          <img id="boiler_st" src="./images/fuego_off.png" class="img-mini" alt="boiler" />

        </div>
          <div class="ui-block-d" >
            <img id="valve_st" src="./images/radiador_on.gif" class="img-mini" alt="valve" />
          </div>
          <div class="ui-block-e" >
            <img id="relay_st" src="./images/off.png" class="img-mini" alt="relay" />
          </div>
           <div class="ui-block-f" >
            <div class="ui-grid-a" style="height:60px" >
              <div class="ui-block-a" >

                  <img src="./images/temp_agua.png" alt="temp" /> 
              </div>
            <div class="ui-block-b" >
              <div id="t_water" class="icon-">--.-</div>
            </div>
            </div>
        </div>
    </div>
  </div><!-- /footer -->
  
</div><!-- /page -->

<div data-role="page" id="page_radiator" data-theme="b">

 <div data-role="header" >   

    <div id="header" class="ui-grid-b" style="height:60px" >
        <div class="ui-block-a"  style="width: 35%" >
          <a href="#page_home" class="ui-btn ui-icon-home ui-btn-icon-notext ui-corner-all" style="margin-top:8px;width: 80px;height: 52px;">No text</a>
        </div>
        <div class="ui-block-b" style="width: 30%" >
            <div id="title_page">
                <h3  class="header-title">RADIADOR MANUAL</h3>
            </div>
        </div>
				
        <div class="ui-block-c" >

            <a id="blind_button" href="#page_radiator_schedule"  class="ui-btn ui-corner-all ui-btn-b header-but" style="margin-left:2px;" onclick="Create_list_schedule_radiator();"  >Agenda</a> 
      </div>
					
    </div><!-- /grid-b -->
  </div>
	
  <div data-role="content" >
    

    <ul data-role="listview" data-inset="true" data-theme="b" data-divider-theme="a" >
    <li data-role="list-divider" style="height: 15px;padding-top:2px;font-size: 18px;text-align: center;font-family: -webkit-pictograph;">AJUSTE TEMPORAL:</li>
      <li style="font-size: 22px;">
        <div class="ui-grid-a">
          <div class="ui-block-a" >
            <!--<input id="input-temp-rad-tempadj" type="number" style="height: 50px" min="14" step="0.1">
-->
                <div class="ui-field-contain" style="width: 150px;margin:0px 2px 0px 2px;">
                    
                    <input type="text" data-role="spinbox" name="spin" id="input-temp-rad-tempadj" data-options='{"type":"vertical"}'  min="14" max="30" step="0.1" style="font-size: 30px;"/>
                </div>
          </div>

            <div class="ui-block-b" >
              <ul data-role="listview" data-inset="true" data-theme="b" data-divider-theme="a" >
              <li style="font-size: 22px;">

              <input id="input-endtime-rad-tempadj" type="text" data-role="datebox" data-options='{"mode":"timebox","timeFormat":"24","timeOutput":"%k:%M"}' style="height:50px" >
              <!--<div class="input-group clockpicker" data-placement="left" data-align="top" data-autoclose="true" style="height:50px" >
              <input type="text" class="form-control" value="13:14">
              <span class="input-group-addon">
                  <span class="glyphicon glyphicon-time"></span>
              </span>
              </div>
              -->
            </li>
            <li style="font-size: 22px;">
         <select id="flip-temporary-temp" name="flip-select" data-role="flipswitch" ><option value="off">Off</option><option value="on">On</option></select>

            
            </li>
            </ul>
           </div>
      </div>
    
      </li>
      
    </ul>
      <ul data-role="listview" data-inset="true" data-theme="b" data-divider-theme="a" >
    <li data-role="list-divider" style="height: 12px;padding-top:2px;font-size: 12px;text-align: center;font-family: -webkit-pictograph;">MODO MANUAL:</li>

      <li style="font-size: 22px;">
        <div class="ui-grid-a" style="height:60px" >
          <div class="ui-block-a" >
  
                <select id="flip-radiator-manual" name="flip-select" data-role="flipswitch" ><option value="auto">Auto</option><option value="manual">Manual</option></select>

          </div>
          <div class="ui-block-b" >
            <div id="radiator-manual-open" class="ui-grid-a" style="height:60px;display:none;" >
              <div class="ui-block-a" >
                 <label style="font-size:20px;font-family: -webkit-pictograph;" >
                RELE:
                </label>
              </div>
              <div class="ui-block-b" >
            <select id="flip-radiator-manual-open" name="flip-select" data-role="flipswitch" ><option value="close">CERRADO</option><option value="open">ABIERTO</option></select>
              </div>
            </div>
          </div>
        </div>
      </li>
    </ul>
  </div><!-- /content -->
  
</div><!-- /page -->
  
  
<div data-role="page" id="page_radiator_schedule" data-theme="b">


  <div data-role="header" >   

    <div id="header" class="ui-grid-b" style="height:60px">
        <div class="ui-block-a" >

          <a href="#page_home" class="ui-btn ui-icon-home ui-btn-icon-notext ui-corner-all " style="margin-top:8px;width: 80px;height: 52px;" onclick="Cancel_changes_schedule('radiator');" >No text</a>

        </div>
        <div class="ui-block-b"  >
            <div id="title_page" >
                <h3 class="header-title">AGENDA RADIADOR</h3>
            </div>
        </div>	
        <div class="ui-block-c" >
          <a  class="ui-btn ui-corner-all ui-btn-a header-but" style="margin-left:2px;margin-top:2px;" onclick="Save_new_schedule('radiator');" >Guardar</a>         
        </div>
					
    </div><!-- /grid-b -->
  </div>
	
  <div data-role="content" style="height:200px">
  
    <ul id="schedule_radiator" data-role="listview" data-inset="true">
      
    </ul>
  
  </div><!-- /content -->
    <div data-role="footer" style="margin: 0 auto;"> 

      <a  href="#page_edit_radiator_schedule" class="ui-btn ui-corner-all ui-btn-a ui-btn-right ui-icon-plus ui-btn-icon-notext " style="margin:0px;width: 70px;height: 40px;"onclick="New_edit_radiator();" ></a> 

  </div>
</div><!-- /page -->

  <div data-role="page" id="page_edit_radiator_schedule" data-theme="b">
    <div data-role="header" >   

    <div id="header" class="ui-grid-b" style="height:60px">
        <div class="ui-block-a" >
          <a  class="ui-btn ui-corner-all ui-btn-b header-but" style="margin-left:2px;margin-top:2px;" href="#page_radiator_schedule">Cancelar</a> 

        </div>
        <div class="ui-block-b"  >
            <div id="title_page" >
                <h3 class="header-title">EDITAR</h3>
            </div>
        </div>	
        <div class="ui-block-c" >
         <a  href="#page_radiator_schedule" class="ui-btn ui-corner-all ui-btn-a header-but" style="margin-left:2px;margin-top:2px;" onclick="Save_edit_radiator()" >Guardar</a>
        </div>
					
    </div><!-- /grid-b -->
  </div>
  
    <div data-role="content" data-theme="a" > 
      <ul id="list_edittask_radiator_content" data-role="listview" data-inset="true">
        <div class="ui-grid-a" style="margin: 15px;">
          <div class="ui-block-a" >
            <div class="ui-grid-b" >
              <div class="ui-block-a" style="width:44%;">
                <!--<input id="input-temp-rad-tempadj" type="number" style="height: 50px" min="14" step="0.1">
    -->
                    <div class="ui-field-contain" style="width: 130px;margin:0px 2px 0px 2px;">

                        <input type="text" data-role="spinbox" name="spin" id="input-edittask-temp-rad-int" data-options='{"type":"vertical"}'  min="14" max="30" step="1" style="font-size: 30px;"/>
                    </div>
              </div>
              <div class="ui-block-b" style="width:10%;">
                <label style="font-size: 40px;margin-top: 75px;" >.</label>
  
              </div>
              <div class="ui-block-c"  >
                <div class="ui-field-contain" style="width: 80px;margin:0px 2px 0px 2px;">

                    <input type="text" data-role="spinbox" name="spin" id="input-edittask-temp-rad-dec" data-options='{"type":"vertical"}'  min="0" max="9" step="1" style="font-size: 30px;"/>
                </div>
                  
              </div>
            </div>
          </div>
          <div class="ui-block-b" style="margin-top:32px;padding-left: 30px;">
              <input id="input-edittask-time-rad" type="text" data-role="datebox" data-options='{"mode":"timebox","timeFormat":"24","timeOutput":"%k:%M"}' style="height:50px;font-size: 32px;" >
          </div>
        </div>
      </ul>
      <ul id ="list_edittask_radiator_buttons" data-role="listview" data-split-theme="a" data-inset="true">
        <div  class="ui-grid-b">
          <div class="ui-block-a" >
      
          </div>
            <div class="ui-block-b" >
            <a id="remove-button" href="#page_radiator_schedule" class="ui-btn ui-corner-all ui-btn-b ui-icon-delete ui-btn-icon-left header-but" style="margin-left:2px;margin-top:2px;" onclick="Remove_task_radiator();" >Eliminar</a> 
          </div>
          <div class="ui-block-c" >
        
          </div>
        </div>
      </ul>
    
  </div><!-- /content -->
</div><!-- /page -->
<div data-role="page" id="page_blind" data-theme="b">

  <div data-role="header" >   

    <div id="header" class="ui-grid-b" style="height:60px">
        <div class="ui-block-a" >

          <a href="#page_home" class="ui-btn ui-icon-home ui-btn-icon-notext ui-corner-all" style="margin-top:8px;width: 80px;height: 52px;">No text</a>

        </div>
        <div class="ui-block-b"  >
            <div id="title_page" >
                <h3 class="header-title" >PERSIANA</h3>
            </div>
        </div>	
        <div class="ui-block-c" >
          <a id="blind_button" href="#page_blind_schedule"  class="ui-btn ui-corner-all ui-btn-b header-but" style="margin-left:2px;" onclick="Create_list_schedule_blind();" >Agenda</a>         
        </div>
					
    </div><!-- /grid-b -->
  </div>
	
  <div data-role="content" >
    
    <ul data-role="listview" data-inset="true">
      
      <li>
        <div class="ui-grid-a">
          <div class="ui-block-a" >
              <ul data-role="listview" data-inset="true" style="width: 110px;margin:0px 20px 0px 30px;">
                  <li style="margin:0px 2px 4px 2px;">
                      <a class="ui-btn ui-icon-carat-u ui-btn-icon-notext " style="width: 100%;height: 40px;margin-left: 5px;" onclick="Manual_selection_blind_position('plus','img-blind-position-temp-adj');"></a>
                  </li>
                  <li data-icon="false">
                    
                    <a class=" ui-corner-all " onclick="Command_manual_blind_position('img-blind-position-temp-adj');" style="min-height: 40px;">
                        <img id="img-blind-position-temp-adj" src="./images/persiana_0.png" class=" ui-corner-all " style="margin-left: 30px;margin-top: 2px;"/>
                    </a>
                    
                  </li>
                  <li style="margin:4px 2px 0px 0px;">
                     <a class="ui-btn ui-icon-carat-d ui-btn-icon-notext" style="width: 100%;height: 40px;margin-left: 5px;" onclick="Manual_selection_blind_position('minus','img-blind-position-temp-adj');"></a>
                  </li>

              </ul>
            
          </div>

            <div class="ui-block-b" >
              <ul data-role="listview" data-inset="true" data-theme="b" data-divider-theme="a" style="padding-right: 80px;">
            <li data-icon="false" style="margin:0px 2px 4px 2px;">
              
             <a class=" ui-corner-all button-blind" onclick="Publish_command('blind','manual','up')">
            <img src="./images/arriba.png" class=" ui-corner-all img-but" style="margin-left: 50px;margin-top: 8px;"/>
            </a>
          
            </li>
            <li data-icon="false" style="margin:0px 2px 4px 2px;">
              
             <a class=" ui-corner-all button-blind" onclick="Publish_command('blind','manual','down')">
            <img src="./images/abajo.png" class=" ui-corner-all img-but" style="margin-left: 50px;margin-top: 8px;"/>
            </a>
          
            </li>
            </ul>
           </div>
      </div>
      
      
        
      </li>
  <!--
      <li style="padding-left: 0px;">
        <div class="ui-grid-d" >
          <div class="ui-block-a" >
            <button class=" ui-corner-all button-blind" onclick="Publish_command('blind','setposition','1')">
            <img src="./images/persiana_1.png" class=" ui-corner-all img-but" />
            </button>
          </div>
          <div class="ui-block-b" >
            <button class=" ui-corner-all button-blind" onclick="Publish_command('blind','setposition','2')">
            <img src="./images/persiana_2.png" class=" ui-corner-all img-but" />
            </button>
          </div>
          <div class="ui-block-c" >
            <button class=" ui-corner-all button-blind" onclick="Publish_command('blind','setposition','3')">
            <img src="./images/persiana_3.png" class=" ui-corner-all img-but" />
            </button>
          </div>
          <div class="ui-block-d" >
            <button class=" ui-corner-all button-blind" onclick="Publish_command('blind','setposition','4')">
            <img src="./images/persiana_4.png" class=" ui-corner-all img-but" />
            </button>
          </div>
          <div class="ui-block-e" >
            <button class=" ui-corner-all button-blind" onclick="Publish_command('blind','setposition','5')">
            <img src="./images/persiana_5.png" class=" ui-corner-all img-but" />
            </button>
          </div>
        </div>
      </li>

      <li style="padding-left: 0px;">
        <div class="ui-grid-b" >
          <div class="ui-block-a" >
             <button class=" ui-corner-all button-blind" onclick="Publish_command('blind','manual','up')">
            <img src="./images/flecha_arriba.png" class=" ui-corner-all img-but" />
            </button>
          </div>
          <div class="ui-block-b" >

          </div>
          <div class="ui-block-c" >
             <button class=" ui-corner-all button-blind" onclick="Publish_command('blind','manual','down')">
            <img src="./images/flecha_abajo.png" class=" ui-corner-all img-but" />
            </button>
          </div>
        </div>
      </li>
-->
    </ul>
    <ul data-role="listview" data-inset="true" data-theme="b" data-divider-theme="a" >
    <li data-role="list-divider" style="height: 15px;padding-top:2px;font-size: 18px;text-align: center;font-family: -webkit-pictograph;">AJUSTE TEMPORAL:</li>
      <li style="font-size: 22px;">
        <div class="ui-grid-a" style="text-align: center;height: 60px;">
          <div class="ui-block-a" style="font-size: 20px;padding-left: 20px;padding-right: 20px;">
            <input id="input-endtime-blind-adj" type="text" data-role="datebox" data-options='{"mode":"timebox","timeFormat":"24","timeOutput":"%k:%M"}' style="height:40px" >

          </div>

            <div class="ui-block-b" style="font-size: 20px;text-align: center;">
              <select id="flip-temporary-temp" name="flip-select" data-role="flipswitch" ><option value="off">Off</option><option value="on">On</option></select>
            </div>

        </div>
    
      </li>
      
    </ul>


  </div><!-- /content -->
  
</div><!-- /page -->

  <div data-role="page" id="page_blind_schedule" data-theme="b">


  <div data-role="header" >   

    <div id="header" class="ui-grid-b" style="height:60px">
        <div class="ui-block-a" >

          <a href="#page_home" class="ui-btn ui-icon-home ui-btn-icon-notext ui-corner-all " style="margin-top:8px;width: 80px;height: 52px;" onclick="Cancel_changes_schedule('blind');" >No text</a>

        </div>
        <div class="ui-block-b"  >
            <div id="title_page" >
                <h3 class="header-title">AGENDA PERSIANA</h3>
            </div>
        </div>	
        <div class="ui-block-c" >
          <a  class="ui-btn ui-corner-all ui-btn-a header-but" style="margin-left:2px;margin-top:2px;" onclick="Save_new_schedule('blind');" >Guardar</a>         
        </div>
					
    </div><!-- /grid-b -->
  </div>
	
  <div data-role="content" style="height:200px">
    <ul id="schedule_blind" data-role="listview" data-inset="true">
      
    </ul>
    
  </div><!-- /content -->
  
    <div data-role="footer" style="margin: 0 auto;"> 

      <a  href="#page_edit_blind_schedule" class="ui-btn ui-corner-all ui-btn-a ui-btn-right ui-icon-plus ui-btn-icon-notext " style="margin:0px;width: 70px;height: 40px;"onclick="New_edit_blind();" ></a> 

  </div>

</div><!-- /page -->
  
  
  
 <div data-role="page" id="page_edit_blind_schedule" data-theme="b">
    <div data-role="header" >   

    <div id="header" class="ui-grid-b" style="height:60px">
        <div class="ui-block-a" >
          <a  class="ui-btn ui-corner-all ui-btn-b header-but" style="margin-left:2px;margin-top:2px;" href="#page_blind_schedule">Cancelar</a> 

        </div>
        <div class="ui-block-b"  >
            <div id="title_page" >
                <h3 class="header-title">EDITAR</h3>
            </div>
        </div>	
        <div class="ui-block-c" >
         <a  href="#page_blind_schedule" class="ui-btn ui-corner-all ui-btn-a header-but" style="margin-left:2px;margin-top:2px;" onclick="Save_edit_blind()" >Guardar</a>
        </div>
					
    </div><!-- /grid-b -->
  </div>
  
    <div data-role="content" data-theme="a" > 
      <ul id="list_edittask_blind_content" data-role="listview" data-inset="true">
        <div class="ui-grid-a" style="margin: 15px;">
          <div class="ui-block-a" >
            
              <ul data-role="listview" data-inset="true" style="width: 110px;margin:0px 2px 0px 2px;">
                  <li >
                      <a class="ui-btn ui-icon-carat-u ui-btn-icon-notext " style="width: 100%;height: 50px;margin-left: 5px;" onclick="Manual_selection_blind_position('plus','img-blind-position-temp-adj');"></a>
                  </li>
                  <li data-icon="false">
                    
                    <a class=" ui-corner-all " onclick="Command_manual_blind_position('img-blind-position-temp-adj');">
                        <img id="img-blind-position-temp-adj" src="./images/persiana_0.png" class=" ui-corner-all " style="margin-left: 30px;margin-top: 10px;"/>
                    </a>
                    
                  </li>
                  <li >
                     <a class="ui-btn ui-icon-carat-d ui-btn-icon-notext" style="width: 100%;height: 50px;margin-left: 5px;" onclick="Manual_selection_blind_position('minus','img-blind-position-temp-adj');"></a>
                  </li>

              </ul>

          </div>
          <div class="ui-block-b" style="margin-top:32px;padding-left: 30px;">
              <input id="input-edittask-time-blind" type="text" data-role="datebox" data-options='{"mode":"timebox","timeFormat":"24","timeOutput":"%k:%M"}' style="height:50px;font-size: 32px;" >
          </div>
        </div>
      </ul>
      <ul id ="list_edittask_blind_buttons" data-role="listview" data-split-theme="a" data-inset="true">
        <div  class="ui-grid-b">
          <div class="ui-block-a" >
      
          </div>
            <div class="ui-block-b" >
            <a id="remove-button" href="#page_blind_schedule" class="ui-btn ui-corner-all ui-btn-b ui-icon-delete ui-btn-icon-left header-but" style="margin-left:2px;margin-top:2px;" onclick="Remove_task_blind();" >Eliminar</a> 
          </div>
          <div class="ui-block-c" >
        
          </div>
        </div>
      </ul>
    
  </div><!-- /content -->
</div><!-- /page -->
<script type="text/javascript">
  

var cmd_action=null;
var srv_cmd=null;
  
var ID_ROOM=2;
var global_room_status=
{
roomid: 2,
connected_central: true,
array_window:[
{id: 0, window_closed: false, door_closed: false, outside_temp: 0, error: 0}
  ],
array_blind: [
 {id: 0, up: false, down: false, push_up: false, push_down: false,position_name:'', position_value: 0, error: 0, current_schedule: {type:"auto",value: 0, end_time:0}}
  ],
array_rad:[
{id: 0, auto_mode: true, relay_closed: false, valve_opened: false, boiler_on: false,
  current_temp: 0, setpoint_temp: 0, water_temp: 0, error: 0, current_schedule: {type:"auto",value: 0, end_time:0}}
  ],
array_rel:[
{id: 0, relay_closed: false, error: 0, current_schedule: {type:"auto",value: 0, end_time:0}}
  ],
error: 0
  
  };

var schedule=[];
var temp_schedule=[];
  


var flip_radiator_manual_change=false;
var flip_radiator_manual_open_change=false;

var id_editing=null;

  
var new_index_task=100;
var new_task=false;

  
function start_ros(){


  // Connecting to ROS
  // -----------------
  ros = new ROSLIB.Ros();

  // If there is an error on the backend, an 'error' emit will be emitted.
  ros.on('error', function(error) {
    //console.log(error);
    $('#console_html').html('</br>Rosbridge:Error  Connection!<br>');
  });

  // Find out exactly when we made a connection.
  ros.on('connection', function() {
    console.log('Connection made!');
    //log_html('Connection made!');
    $('#console_html').html('</br>Rosbridge: Connection made!<br>');
  });

  // Create a connection to the rosbridge WebSocket server.
  ros.connect('ws://localhost:9090');

  //ros.connect('ws://192.168.1.109:9090');
  // Publishing a Topic
  // ------------------

/*  cmd_action = new ROSLIB.Topic({
    ros : ros,
    name : 'domopin/set_array_actions',
    serviceType : 'domopin/ServActions'

  });
*/
    cmd_action = new ROSLIB.Topic({
    ros : ros,
    name : 'domopin/command',
    messageType : 'std_msgs/String'
  });


    srv_cmd = new ROSLIB.Service({
    ros : ros,
    name : 'domopin/srv_command_'+global_room_status.roomid,
    serviceType : 'domopin/ServCommand'
  });
Subscribe();
  

Publish_config_command('get_next_tasks','');
  
Publish_config_command('get_schedule','');
}
 
function Subscribe(){

listener_status_room = new ROSLIB.Topic({
    ros : ros,
    name : 'domopin/room_status',
    messageType : 'domopin_msgs/RoomStatus'
  });

  listener_cmd_room = new ROSLIB.Topic({
    ros : ros,
    name : 'domopin/command',
    messageType : 'std_msgs/String'
  });

  
listener_status_room.subscribe(function(msg) {

  if (msg.roomid==ID_ROOM){
    
  
    // PARSEAR VARIABLES

              

  
       if (msg.connected_central ==true && global_room_status.connected_central==false ){
        $("#comm_st").attr("src","./images/central_comm.png");
         
      }else if (msg.connected_central == false && global_room_status.connected_central==true ){
        
        $("#comm_st").attr("src","./images/no-central_comm.png");
      }     
    
      if (msg.array_rad[0].auto_mode ==true && global_room_status.array_rad[0].auto_mode ==false ){
        $("#mode_st").attr("src","./images/mode_auto.png");
      }else if (msg.array_rad[0].auto_mode == false && global_room_status.array_rad[0].auto_mode ==true){
        
        $("#mode_st").attr("src","./images/mode_manual.png");
      }
      
      //console.log('Tint='+Tint);
      if (msg.array_rad[0].relay_closed ==true && global_room_status.array_rad[0].relay_closed ==false ){
        $("#relay_st").attr("src","./images/on.png");
      }else if (msg.array_rad[0].relay_closed == false){
        
        $("#relay_st").attr("src","./images/off.png");
      }

      if (msg.array_rad[0].valve_opened ==true){
        
        $("#valve_st").attr("src","./images/radiador_on.gif");
      }else if (msg.array_rad[0].valve_opened == false){
        $("#valve_st").attr("src","./images/radiador_off.png");
      }              
      if (msg.array_rad[0].boiler_on ==true && global_room_status.array_rad[0].boiler_on ==false){
      
        $("#boiler_st").attr("src","./images/fuego.gif");
      }else if (msg.array_rad[0].boiler_on == false){
        $("#boiler_st").attr("src","./images/fuego_off.png");
      }      
      
      if (msg.array_rad[0].current_temp != global_room_status.array_rad[0].current_temp ){
        var Tint=parseFloat(msg.array_rad[0].current_temp/10.0);
        $("#t_int").html(Tint.toFixed(1));
      }
      if (msg.array_rad[0].setpoint_temp != global_room_status.array_rad[0].setpoint_temp ){
        var Tsetpoint=parseFloat(msg.array_rad[0].setpoint_temp/10.0);
        $("#t_setpoint").html(Tsetpoint.toFixed(1));
      }
  
    
      if (msg.array_rad[0].water_temp != global_room_status.array_rad[0].water_temp ){
        var Twater=parseFloat(msg.array_rad[0].water_temp/10.0);
        $("#t_water").html(Twater.toFixed(1));
      } 
    
    //BLIND
    
      $("#status_blin_position").attr("src","./images/position_"+msg.array_blind[0].position_name+".png");
    
      if (msg.array_blind[0].up ==true && global_room_status.array_blind[0].up ==false){
        $("#status_blind_push").attr("src","./images/flecha_estado_arriba.gif");
      }else if (msg.array_blind[0].down ==true && global_room_status.array_blind[0].down ==false ){
        $("#status_blind_push").attr("src","./images/flecha_estado_abajo.gif");
      }else{
        $("#status_blind_push").attr("src","");
      }     
      
    // WINDOW
    
      if (msg.array_window[0].door_closed ==true && global_room_status.array_window[0].door_closed ==false ){
        $("#door_st").html("Cerrada");
      }else if (msg.array_window[0].door_closed == false && global_room_status.array_window[0].door_closed ==true){
        
        $("#door_st").html("Abierta");
      }
      if (msg.array_window[0].window_closed ==true && global_room_status.array_window[0].window_closed ==false ){
        $("#window_st").html("Cerrada");
      }else if (msg.array_window[0].window_closed == false && global_room_status.array_window[0].window_closed ==true){
        
        $("#window_st").html("Abierta");
      }
   global_room_status=msg; 
  }
        
});
  
  listener_cmd_room.subscribe(function(msg) {
  
  var obj = jQuery.parseJSON(msg.data);
    
    //console.log( 'obj='+msg.data);
    if (obj.type=='config' && obj.roomid==ID_ROOM){
      
      if (obj.action=='set_next_tasks'){
        
        
        var tasks=obj.value.slice();
        Create_list_next_tasks(tasks);
      

      }
      
      else if (obj.action=='current_schedule'){
        
        schedule=obj.value.slice();
        temp_schedule=obj.value.slice();
          
        console.log( 'current_schedule='+schedule.length);
        
      }
    }
    
    });

}




function Read_file(name_file) {
console.log('Read_file');

    $.ajax({
    	url: name_file,
    	async: false,
		cache:false,
    	dataType: 'json',
    	success: function(data) {
    		temp_data = data;
			
    	}
    });

return temp_data
}





$('.clockpicker').clockpicker();

$(document).on("pageshow","#page_main",function(){

//temp_schedule=schedule;

});
  
  
$(document).on("pageshow","#page_radiator",function(){

  if(global_room_status.array_rad[0].current_schedule.type=='temporary'){
    var Tsetpoint=parseFloat(global_room_status.array_rad[0].setpoint_temp/10.0);
    $('#input-temp-rad-tempadj').val(Tsetpoint.toFixed(1));
    $("#flip-temporary-temp").val("on").flipswitch('refresh');
  }
  else {//if(global_room_status.array_rad[0].current_schedule.type=='auto'){
    
    var Tsetpoint=parseFloat(global_room_status.array_rad[0].setpoint_temp/10.0);
    $('#input-temp-rad-tempadj').val(Tsetpoint.toFixed(1));
    
    $("#flip-temporary-temp").val("off").flipswitch('refresh');
  }
 

  if(global_room_status.array_rad[0].auto_mode==true){
    
    $("#flip-radiator-manual").val("auto").flipswitch('refresh');
    //flip_radiator_manual_change=true;
  }
  else if(global_room_status.array_rad[0].auto_mode==false){
    
    $("#flip-radiator-manual").val("manual").flipswitch('refresh');
    //flip_radiator_manual_change=true;
  }
  
  
  //$('#input-temp-rad-tempadj').val=global_room_status.array_rad[0].setpoint_temp;
  //$('#input-temp-radiator').val=global_room_status.array_rad[0].setpoint_temp;

  
});

$(document).on("pageshow","#page_blind_schedule",function(){

    $('#schedule_blind').listview('refresh');

    //Create_list_schedule_blind();

});

  $(document).on("pageshow","#page_radiator_schedule",function(){

    //$('#schedule_radiator').empty().listview('refresh');
    
    $('#schedule_radiator').listview('refresh');

    //Create_list_schedule_radiator();

});
  

$("#flip-temporary-temp").on("change", function(e) {
  
  var value = this.value;
  if(value=='on'){
    //global_room_status.array_rad[0].current_schedule.type=='temporary'
    var setpoint=$("#input-temp-rad-tempadj").val()*10 ;
    var time=$("#input-endtime-rad-tempadj").val() ;
    var temp_time=time.split(':');
    time=parseInt(temp_time[0]+''+temp_time[1]);
    console.log('setpoint='+setpoint);
    console.log('time='+time);
    var json_value={type:"temporary",value: setpoint, end_time:time}
  
    Publish_command('radiator','radiator_adj_temp',json_value);
  }
  else{
    //global_room_status.array_rad[0].current_schedule.type=='auto'
    Publish_command('radiator','cancel_radiator_adj_temp',0);
    
  }
});
  
$("#flip-radiator-manual").on("change", function(e) {
  
//console.log('flip-radiator-manual::flip_radiator_manual_change= '+flip_radiator_manual_change);
  if(flip_radiator_manual_change==false){
      var value = this.value;
      console.log('value:: '+value);
      Publish_command('radiator','mode',value);
     
    if(value=='manual'){
       flip_radiator_manual_open_change=true;
       var relay='open';
       if (global_room_status.array_rad[0].relay_closed==true)relay='close';
        console.log('flip-radiator-manual::relay='+relay);
      
       $("#flip-radiator-manual-open").val(relay).flipswitch('refresh');
      
       $("#radiator-manual-open").show();
    }
    if(value=='auto'){
      
       $("#radiator-manual-open").hide();
    }
  }
  else{
    flip_radiator_manual_change=false;
  }
});

$("#flip-radiator-manual-open").on("change", function(e) {
  

  if(flip_radiator_manual_open_change==false){
      var value = this.value;
      console.log('value:: '+value);
      Publish_command('radiator','manual_cmd',value);
      
    
  }
  else{
    flip_radiator_manual_open_change=false;
  }
});
  

function Create_list_next_tasks(tasks){
        
        console.log( 'tasks.length='+tasks.length);
        
        var blind_tasks=[];
        var radiator_tasks=[];
        
        for (i=0;i<tasks.length;i++){
          
          if (tasks[i].action[0].device=='blind'){
            
            var obj={"timealert":tasks[i].timealert ,"value": tasks[i].action[0].value }

            
            blind_tasks.push(obj)
              
          }
          else if (tasks[i].action[0].device=='radiator'){
            
            var obj={"timealert":tasks[i].timealert ,"value": tasks[i].action[0].value }

            radiator_tasks.push(obj)
              
          }
                   

        }
      
        //console.log( 'obj='+radiator_tasks[0]);
        for (i=0;i<2;i++){
          
          var index=i+1;
          if ( radiator_tasks[i]){

            var timedefault=["0","0","0","0"]
            var time=radiator_tasks[i].timealert.toString(10).split('');

            for(t=time.length-1;t>-1;t--){

              timedefault[t]=time[t];

            }
            $("#next_"+index+"_time_rad").html(timedefault[0]+""+timedefault[1]+":"+timedefault[2]+""+timedefault[3]);
            var T=parseFloat(radiator_tasks[i].value/10.0);
            $("#next_"+index+"_temp_rad").html(T.toFixed(1)+' ºC');

          }
          else{

            $("#next_"+index+"_time_rad").html("--:-- ");

            $("#next_"+index+"_temp_rad").html("--.- ºC");

          }
          
        }
        
console.log('global_room_status='+global_room_status.array_rad[0].current_schedule.type);
        
        if(global_room_status.array_rad[0].current_schedule.type=='temporary'){
          var timedefault=["0","0","0","0"]
            var time=global_room_status.array_rad[0].current_schedule.end_time.toString(10).split('');

            for(t=time.length-1;t>-1;t--){

              timedefault[t]=time[t];
            }
          var T=global_room_status.array_rad[0].current_schedule.end_time/10.0;

          $("#adj_temp_time_rad").html(timedefault[0]+""+timedefault[1]+":"+timedefault[2]+""+timedefault[3]);
          //$("#grid_adj_temp_rad").css('style','display:block');
              $("#grid_adj_temp_rad").show();
        }else{
          
          console.log('grid_adj_temp_rad hide');
          
          $("#grid_adj_temp_rad").hide(); //.css('style','display:none');
        }
        
        $("#list_status_rad").listview('refresh');
        
        
        // blind
            for (i=0;i<2;i++){
          
          var index=i+1;
          if ( blind_tasks[i]){
console.log( 'obj='+blind_tasks[i].timealert);
            var timedefault=["0","0","0","0"]
            var time=blind_tasks[i].timealert.toString(10).split('');

            for(t=time.length-1;t>-1;t--){

              timedefault[t]=time[t];

            }
            $("#next_"+index+"_time_blind").html(timedefault[0]+""+timedefault[1]+":"+timedefault[2]+""+timedefault[3]);
            $("#next_"+index+"_pose_blind").attr("src","./images/persiana_"+blind_tasks[i].value+".png");

          }
          else{

            $("#next_"+index+"_time_blind").html("--:--");

            $("#next_"+index+"_pose_blind").attr("src","");

          }
          
        }
        
        
        $("#list_status_blind").listview('refresh');
  
  
  
  
}
function  Create_list_schedule_radiator(){

  //$('#schedule_radiator').empty().listview('refresh');

  
    //temp_schedule=schedule;
  
	for (var i=0;i<temp_schedule.length;i++){
	var item=temp_schedule[i];
    
    var selected_on=""
    if (temp_schedule[i].enable == 'true'){
      
      selected_on='selected=""';
     
    }
    var timedefault=["0","0","0","0"]
    var time=temp_schedule[i].timealert.toString(10).split('');

    for(t=time.length-1;t>-1;t--){

      timedefault[t]=time[t];

    }
    var item_time= timedefault[0]+""+timedefault[1]+":"+timedefault[2]+""+timedefault[3];
      
      if(item.action[0].device=="radiator"){
        var setpoint=item.action[0].value/10;
        setpoint=setpoint.toFixed(1);

        $('#schedule_radiator').append(
              $('<li>').attr("id","task_"+item.id).append(
                $('<div>').attr('class',' ui-grid-a').attr("style","padding-left:20px;").append(
                      $('<div>').attr('class',' ui-block-a').attr("style","width:70%;").append(
                        
                        $('<a>').attr("href","#page_edit_radiator_schedule").attr("class","list-schedule").bind('vclick',function(){
                          
                            
                         var id = $(this).parent().parent().parent();
                         Edit_event_radiator(id);
                        }).append(
                          $('<div>').attr('class',' ui-grid-a').append(
                            $('<div>').attr('class',' ui-block-a').append(
                              $('<h2>').attr("id","timealert").text(item_time)
                            ),
                            $('<div>').attr('class',' ui-block-b').append(
                              $('<h2>').attr("id","setpoint").text(setpoint)
                            )
                          )
                        )
                      ),
                      $('<div>').attr('class',' ui-block-b').attr("style","width:28%;").append(
                        
                  //'<input type="checkbox" data-role="flipswitch" name="flip-checkbox-4" id="flip-checkbox-4" '+enable+' data-mini="true">'
'<select id="flip-radiator-'+item.id+'" name="flip-select" data-role="flipswitch" data-mini="true"><option value="off">Off</option><option '+selected_on+' value="on">On</option></select>'
                
                 //$('<input>').attr('type',' checkbox').attr('id',' flip').attr('name',' flip').attr('data-role',' flipswitch').attr('data-mini',' true')
                     
                 //$('<select>').attr('id',' flip').attr('name',' flip-select').attr('data-role',' flipswitch').attr('data-mini',' true')
                    )
               )
            )
          );
          
        

	     //$('#list_events').append(lista.children()).enhanceWithin().listview('refresh');
      }
	} 
  $('#schedule_radiator').enhanceWithin().listview('refresh');
  
  
  
  
}
function Create_list_schedule_blind(){

console.log('Create_list_schedule_blind');
  
    //temp_schedule=schedule;
	for (var i=0;i<temp_schedule.length;i++){
	var item=temp_schedule[i];

    var selected_on=""
    if (temp_schedule[i].enable == 'true'){
      
      selected_on='selected=""';
     
    }
    var timedefault=["0","0","0","0"]
    var time=temp_schedule[i].timealert.toString(10).split('');

    for(t=time.length-1;t>-1;t--){

      timedefault[t]=time[t];

    }
    var item_time= timedefault[0]+""+timedefault[1]+":"+timedefault[2]+""+timedefault[3];
      
      if(item.action[0].device=="blind"){
        var position_image="./images/persiana_"+item.action[0].value+".png"

        $('#schedule_blind').append(
              $('<li>').attr("id","task_"+item.id).append(
                $('<div>').attr('class',' ui-grid-a').attr("style","padding-left:20px;").append(
                      $('<div>').attr('class',' ui-block-a').attr("style","width:70%;").append(
                        
                        $('<a>').attr("href","#page_edit_blind_schedule").attr("class","list-schedule").bind('vclick',function(){
                          
                            
                         var id = $(this).parent().parent().parent();
                         Edit_event_blind(id);
                        }).append(
                          $('<div>').attr('class',' ui-grid-a').append(
                            $('<div>').attr('class',' ui-block-a').append(
                              $('<h2>').attr("id","timealert").text(item_time)
                            ),
                            $('<div>').attr('class',' ui-block-b').append(
                              $('<img>').attr("id","position_"+item.action[0].value).attr("src",position_image).attr("class","img-mini").attr("style","padding-top:4px;")
                            )
                          )
                        )
                      ),
                      $('<div>').attr('class',' ui-block-b').attr("style","width:28%;").append(
                        
                  //'<input type="checkbox" data-role="flipswitch" name="flip-checkbox-4" id="flip-checkbox-4" '+enable+' data-mini="true">'
'<select id="flip-blind-'+item.id+'" name="flip-select" data-role="flipswitch" data-mini="true"><option value="off">Off</option><option '+selected_on+' value="on">On</option></select>'
                
                 //$('<input>').attr('type',' checkbox').attr('id',' flip').attr('name',' flip').attr('data-role',' flipswitch').attr('data-mini',' true')
                     
                 //$('<select>').attr('id',' flip').attr('name',' flip-select').attr('data-role',' flipswitch').attr('data-mini',' true')
                    )
               )
            )
          );
          
        

	     //$('#list_events').append(lista.children()).enhanceWithin().listview('refresh');
      }
	} 
  $('#schedule_blind').enhanceWithin().listview('refresh');
  
 
}

function Edit_event_blind(id){
  
  $('#remove-button-blind').show();
  new_task=false;
  
  var nameid=id.attr('id').split('_');
  var task_id=parseInt(nameid[1]);
  var index=-1;
  
  for (i=0;i<temp_schedule.length;i++){
    if(temp_schedule[i].id==task_id){
      index=i;
      
    }
    
  }
  
  id_editing=task_id;

  var time=temp_schedule[index].timealert.toString(10).split('');
  var timedefault=["0","0","0","0"]

  for(t=time.length-1;t>-1;t--){

    timedefault[t]=time[t];

  }

    var position=temp_schedule[index].action[0].value;

  $('#input-edittask-position-blind').val(position);
  $('#input-edittask-time-blind').val(timedefault[0]+""+timedefault[1]+":"+timedefault[2]+""+timedefault[3]);
  
  

}
  
  
function Save_edit_blind(){
  

    var position=parseInt($("#input-edittask-position-blind").val());
    var time=$("#input-edittask-time-blind").val() ;
    var temp_time=time.split(':');
    var int_time=parseInt(temp_time[0]+''+temp_time[1]);

   if (new_task==true){ //new
       
       var task={ "id": new_index_task ,"timealert": int_time,"enable": "true", "type":"action", "action": [{"roomid": global_room_status.roomid,"device":"blind", "id": 1,"command":"setpoint" , "value":position }]}
      
       new_index_task++;
     
     temp_schedule.push(task);

  }else{  //edit
    var index=-1;
  
  for (i=0;i<temp_schedule.length;i++){
    if(temp_schedule[i].id==id_editing){
      index=i;
      
    }
    
  }
  
    temp_schedule[index].timealert=int_time;
    temp_schedule[index].action[0].value=position;
    

}
      temp_schedule.sort(function(obj1, obj2) {
	// Ascending: first age less than the previous
	return obj1.timealert - obj2.timealert;
    });
    
      console.log('temp_schedule=');

    console.log(temp_schedule);
     
    $('#schedule_blind').empty().listview('refresh');
    Create_list_schedule_blind();
}
  
  function Remove_task_blind(){
  

    var index=-1;
  
  for (i=0;i<temp_schedule.length;i++){
    if(temp_schedule[i].id==id_editing_task_blind){
      index=i;
      
    }
    
  }
  temp_schedule.splice(index, 1);
    
    console.log('temp_schedule='+temp_schedule);
    
    $('#schedule_blind').empty().listview('refresh');
    Create_list_schedule_blind();

  /*
  var nameid=$('#schedule_radiator').find('#task_'+id_editing);
  
  var timealert=nameid.children().find('#timealert').html(time);
  var timealert=nameid.children().find('#setpoint').html($("#input-edittask-temp-rad-int").val()+'.'+$("#input-edittask-temp-rad-dec").val());
*/
 

}
function New_edit_blind(){
  
  $('#remove-button-blind').hide();
  new_task=true;
  
  $('#input-edittask-position-blind').val(0);
  
}

  function Remove_task_blind(){
  

    var index=-1;
  
  for (i=0;i<temp_schedule.length;i++){
    if(temp_schedule[i].id==id_editing){
      index=i;
      
    }
    
  }
  temp_schedule.splice(index, 1);
    
    
    $('#schedule_blind').empty().listview('refresh');
    Create_list_schedule_blind();

  /*
  var nameid=$('#schedule_radiator').find('#task_'+id_editing);
  
  var timealert=nameid.children().find('#timealert').html(time);
  var timealert=nameid.children().find('#setpoint').html($("#input-edittask-temp-rad-int").val()+'.'+$("#input-edittask-temp-rad-dec").val());
*/
 

}
  
  
function Edit_event_radiator(id){
  
  $('#remove-button').show();
  new_task=false;
  
  var nameid=id.attr('id').split('_');
  var task_id=parseInt(nameid[1]);
  var index=-1;
  
  for (i=0;i<temp_schedule.length;i++){
    if(temp_schedule[i].id==task_id){
      index=i;
      
    }
    
  }
  
  id_editing=task_id;

  var time=temp_schedule[index].timealert.toString(10).split('');
  var timedefault=["0","0","0","0"]

  for(t=time.length-1;t>-1;t--){

    timedefault[t]=time[t];

  }

    var setpoint=temp_schedule[index].action[0].value.toString(10).split('');
  var setpoint_int=parseInt(setpoint[0]+''+setpoint[1]);
  var setpoint_dec=parseInt(setpoint[2]);

  
  
  $('#input-edittask-temp-rad-int').val(setpoint_int);
  $('#input-edittask-temp-rad-dec').val(setpoint_dec);
  $('#input-edittask-time-rad').val(timedefault[0]+""+timedefault[1]+":"+timedefault[2]+""+timedefault[3]);
  
  

}
  
  
function Save_edit_radiator(){
  
    //global_room_status.array_rad[0].current_schedule.type=='temporary'
    var setpoint=parseInt($("#input-edittask-temp-rad-int").val()+''+$("#input-edittask-temp-rad-dec").val()) ;
    var time=$("#input-edittask-time-rad").val() ;
    var temp_time=time.split(':');
    var int_time=parseInt(temp_time[0]+''+temp_time[1]);

   if (new_task==true){ //new
       
       var task={ "id": new_index_task ,"timealert": int_time,"enable": "true", "type":"action", "action": [{"roomid": global_room_status.roomid,"device":"radiator", "id": 1,"command":"setpoint" , "value":setpoint }]}
      
       new_index_task++;
     
     temp_schedule.push(task);

  }else{  //edit
    var index=-1;
  
  for (i=0;i<temp_schedule.length;i++){
    if(temp_schedule[i].id==id_editing){
      index=i;
      
    }
    
  }
  
    temp_schedule[index].timealert=int_time;
    temp_schedule[index].action[0].value=setpoint;
    

    /*
  var nameid=$('#schedule_radiator').find('#task_'+id_editing);
  
  var timealert=nameid.children().find('#timealert').html(time);
  var timealert=nameid.children().find('#setpoint').html($("#input-edittask-temp-rad-int").val()+'.'+$("#input-edittask-temp-rad-dec").val());
  */

}
      temp_schedule.sort(function(obj1, obj2) {
	// Ascending: first age less than the previous
	return obj1.timealert - obj2.timealert;
    });
    
      console.log('temp_schedule=');

    console.log(temp_schedule);
     
    $('#schedule_radiator').empty().listview('refresh');
    Create_list_schedule_radiator();

}
  
function New_edit_radiator(){
  
  $('#remove-button').hide();
  new_task=true;
  
  $('#input-edittask-temp-rad-int').val(20);
  $('#input-edittask-temp-rad-dec').val(0);
}
  
function Remove_task_radiator(){
  

    var index=-1;
  
  for (i=0;i<temp_schedule.length;i++){
    if(temp_schedule[i].id==id_editing){
      index=i;
      
    }
    
  }
  temp_schedule.splice(index, 1);
    
    
    $('#schedule_radiator').empty().listview('refresh');
    Create_list_schedule_radiator();

  /*
  var nameid=$('#schedule_radiator').find('#task_'+id_editing);
  
  var timealert=nameid.children().find('#timealert').html(time);
  var timealert=nameid.children().find('#setpoint').html($("#input-edittask-temp-rad-int").val()+'.'+$("#input-edittask-temp-rad-dec").val());
*/
 

}
  
function Save_new_schedule(device){
  
 
   $("#schedule_"+device+" li").each(function(n) {
      var nameid=$(this).attr("id").split('_');
      var task_id=parseInt(nameid[1]);
     
     var flip=$("#flip-"+device+"-"+task_id).val();
     var enable=true;
     if(flip=='off')enable=false;
     
     var index=-1;
     for (i=0;i<temp_schedule.length;i++){
        if(temp_schedule[i].id==task_id){
          index=i;
          break;

        }
    
      }
     
     temp_schedule[index].enable=enable;
     

      });
  

 
  var json_data={"type":"save_schedule", "value":temp_schedule}

   var JSONstr = JSON.stringify(json_data);
   var request = new ROSLIB.ServiceRequest({
    json_req : JSONstr
  });
  // Finally, we call the /add_two_ints service and get back the results in the callback. The result
  // is a ROSLIB.ServiceResponse object.
  srv_cmd.callService(request, function(result) {
    
    console.log('Result for service call on ' + srv_cmd.name + ': ' + result.json_ret);
    var obj = jQuery.parseJSON(result.json_ret);
    schedule=obj.current_schedule.slice();
    temp_schedule=obj.current_schedule.slice();
    
     if (device=='radiator'){
       $('#schedule_radiator').empty().listview('refresh');
       Create_list_schedule_radiator();

    }else{
      $('#schedule_blind').empty().listview('refresh');

      Create_list_schedule_blind();
    }
    
    var tasks=obj.list_tasks.slice();

    Create_list_next_tasks(tasks);
    
  });
  
}

function Cancel_changes_schedule(device){

  temp_schedule=schedule.slice();
  
  $('#schedule_radiator').empty().listview('refresh');
  $('#schedule_blind').empty().listview('refresh');
  
}
  

function Manual_selection_blind_position(command,div){

  var temp_position=$('#'+div).attr("src").split('_');
  var position=temp_position[1][0];
  console.log('position='+position);
  
  
  if (command=='plus'){
    position++;
  }else if(command=='minus'){
    position --;
          
  }
  
  if(position>5)position=5;
  if (position <0)position=0;
  
  $('#'+div).attr("src","./images/persiana_"+position+".png");
                                       
}
  
function Command_manual_blind_position(div){

  var temp_position=$('#'+div).attr("src").split('_');
  var position=temp_position[1][0];
  Publish_command('blind','setposition',position);
  
}
function Publish_command(dev,com,value){
  

  var id_dev=dev;
  var cmd=com;
  var val=value;
  
  
  
  //cmd={"action": [{"roomid": IDROOM,"device":"radiator", "id": 1,"command":"setpoint" , "value":value }]}
  //var cmd={"action": [{"roomid": 4,"device":"blind", "id": 1,"command":"setposition" , "value":value }]}  
  
  var cmd_str={"type":"action","action": [{"roomid":ID_ROOM  ,"device": id_dev, "id": 1,"command":cmd, "value": val }]}
  
  var JSONstr = JSON.stringify(cmd_str);
  var cmd_str = new ROSLIB.Message({
    data: JSONstr

  });       

    cmd_action.publish(cmd_str)
  
}

  
function Publish_config_command(com,value){

  var cmd=com;
  var val=value;
  
  var cmd_str={"type":"config","roomid": ID_ROOM,"action":cmd,"value": value} ;
  
  var JSONstr = JSON.stringify(cmd_str);
  var cmd_str = new ROSLIB.Message({
    data: JSONstr

  });       

    cmd_action.publish(cmd_str)
  
}
  

</script>

</body>
</html>
